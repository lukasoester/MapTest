<!doctype HTML>
<meta charset = 'utf-8'>
<html>
  <head>
    <link rel='stylesheet' href='http://timelyportfolio.github.io/rCharts_d3_sankey//css/sankey.css'>
    
    <script src='http://timelyportfolio.github.io/rCharts_d3_sankey//js/d3.v3.js' type='text/javascript'></script>
    <script src='http://timelyportfolio.github.io/rCharts_d3_sankey//js/sankey.js' type='text/javascript'></script>
    
    <style>
    .rChart {
      display: block;
      margin-left: auto; 
      margin-right: auto;
      width: 960px;
      height: 500px;
    }  
    </style>
    
  </head>
  <body >
    
    <div id = 'chart21541f297cdc' class = 'rChart rCharts_d3_sankey'></div>    
    ﻿<!--Attribution:
Mike Bostock https://github.com/d3/d3-plugins/tree/master/sankey
Mike Bostock http://bost.ocks.org/mike/sankey/
-->

<script>
(function(){
var params = {
 "dom": "chart21541f297cdc",
"width":    960,
"height":    500,
"data": {
   "source":["KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","KULTURLAND","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","VERSORGUNGSSICHERHEIT","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","BIODIVERSITAET","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","PRODUKTIONSSYSTEME","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","LANDSCHAFTSQUALITAET","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","RESSOURCENEFFIZIENZ","FR","FR","FR","FR","FR","FR","FR","FR","FR","FR","SO","SO","SO","SO","SO","SO","SO","SO","SO","99","99","99","99","99","99","99","99","99","99","99","99","AG","AG","AG","AG","AG","AG","AG","AG","AG","AG","AG","AG","AI","AI","AI","AI","AI","AI","AR","AR","AR","AR","AR","BE","BE","BE","BE","BE","BE","BE","BE","BE","BE","BE","BE","BL","BL","BL","BL","BL","BL","BL","BL","BL","BL","GE","GE","GE","GE","GE","GE","GL","GL","GL","GL","GR","GR","GR","GR","GR","GR","GR","JU","JU","JU","JU","JU","JU","JU","LU","LU","LU","LU","LU","LU","LU","LU","LU","LU","LU","LU","NE","NE","NE","NE","NE","NE","NE","NE","NW","NW","NW","NW","NW","OW","OW","OW","OW","SG","SG","SG","SG","SG","SG","SG","SG","SG","SG","SG","SH","SH","SH","SH","SH","SH","SZ","SZ","SZ","SZ","SZ","SZ","TG","TG","TG","TG","TG","TG","TG","TG","TG","TG","TG","TG","TI","TI","TI","TI","TI","TI","TI","UR","UR","UR","UR","VD","VD","VD","VD","VD","VD","VD","VD","VD","VD","VS","VS","VS","VS","VS","VS","VS","ZG","ZG","ZG","ZG","ZG","ZH","ZH","ZH","ZH","ZH","ZH","ZH","ZH","ZH","ZH","ZH","ZH","Ackerbau","Gemüse- /Gartenbau","Obstbau","Weinbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Schwein","Geflügel","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Ackerbau","Gemüse- /Gartenbau","Obstbau","Weinbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Schwein","Geflügel","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Talgebiet","Talgebiet","Talgebiet","Talgebiet","Talgebiet","Talgebiet","Berggebiet","Berggebiet","Berggebiet","Berggebiet","Berggebiet","Berggebiet"],
   "target":["FR","SO","99","AG","AI","AR","BE","BL","GE","GL","GR","JU","LU","NE","NW","OW","SG","SH","SZ","TG","TI","UR","VD","VS","ZG","ZH","FR","SO","99","AG","AI","AR","BE","BL","GE","GL","GR","JU","LU","NE","NW","OW","SG","SH","SZ","TG","TI","UR","VD","VS","ZG","ZH","FR","SO","99","AG","AI","AR","BE","BL","GE","GL","GR","JU","LU","NE","NW","OW","SG","SH","SZ","TG","TI","UR","VD","VS","ZG","ZH","FR","SO","99","AG","AI","AR","BE","BL","GE","GL","GR","JU","LU","NE","NW","OW","SG","SH","SZ","TG","TI","UR","VD","VS","ZG","ZH","FR","SO","99","AG","AI","AR","BE","BL","GE","GL","GR","JU","LU","NE","NW","OW","SG","SH","SZ","TG","TI","UR","VD","VS","ZG","ZH","FR","SO","99","AG","AI","AR","BE","BL","GE","GL","GR","JU","LU","NE","OW","SG","SH","SZ","TG","TI","VD","VS","ZG","ZH","Ackerbau","Gemüse- /Gartenbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Schwein","Geflügel","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Ackerbau","Gemüse- /Gartenbau","Obstbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Ackerbau","Gemüse- /Gartenbau","Obstbau","Weinbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Schwein","Geflügel","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Ackerbau","Gemüse- /Gartenbau","Obstbau","Weinbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Schwein","Geflügel","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Schwein","Geflügel","Andere/Nicht zugeteilt","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Schwein","Andere/Nicht zugeteilt","Ackerbau","Gemüse- /Gartenbau","Obstbau","Weinbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Schwein","Geflügel","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Ackerbau","Gemüse- /Gartenbau","Obstbau","Weinbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Ackerbau","Gemüse- /Gartenbau","Weinbau","Perde/Schafe/Ziegen","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Andere/Nicht zugeteilt","Weinbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Ackerbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Ackerbau","Gemüse- /Gartenbau","Obstbau","Weinbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Schwein","Geflügel","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Ackerbau","Weinbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Schwein","Andere/Nicht zugeteilt","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Andere/Nicht zugeteilt","Gemüse- /Gartenbau","Obstbau","Weinbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Schwein","Geflügel","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Ackerbau","Weinbau","Perde/Schafe/Ziegen","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Schwein","Geflügel","Andere/Nicht zugeteilt","Ackerbau","Gemüse- /Gartenbau","Obstbau","Weinbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Schwein","Geflügel","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Ackerbau","Gemüse- /Gartenbau","Weinbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Andere/Nicht zugeteilt","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Andere/Nicht zugeteilt","Ackerbau","Gemüse- /Gartenbau","Obstbau","Weinbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Gemüse- /Gartenbau","Obstbau","Weinbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Andere/Nicht zugeteilt","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Kombiniert Verkehrsmilch/Ackerbau","Andere/Nicht zugeteilt","Ackerbau","Gemüse- /Gartenbau","Obstbau","Weinbau","Verkehrsmilch","Mutterkühe","Perde/Schafe/Ziegen","Schwein","Geflügel","Kombiniert Verkehrsmilch/Ackerbau","Kombiniert Mutterkühe","Andere/Nicht zugeteilt","Bio","Bio","Bio","Bio","Bio","Bio","Bio","Bio","Bio","Bio","Bio","Bio","Nicht Bio","Nicht Bio","Nicht Bio","Nicht Bio","Nicht Bio","Nicht Bio","Nicht Bio","Nicht Bio","Nicht Bio","Nicht Bio","Nicht Bio","Nicht Bio","KULTURLAND","VERSORGUNGSSICHERHEIT","BIODIVERSITAET","PRODUKTIONSSYSTEME","LANDSCHAFTSQUALITAET","RESSOURCENEFFIZIENZ","KULTURLAND","VERSORGUNGSSICHERHEIT","BIODIVERSITAET","PRODUKTIONSSYSTEME","LANDSCHAFTSQUALITAET","RESSOURCENEFFIZIENZ"],
   "value":[18053,5217,8459,5877,4311,7137,78713,4175,176,5777,53547,11767,22317,10583,4821,7737,30615,761,16615,2110,8697,9592,22550,31446,3075,6292,77995,30430,27703,60461,7801,12760,208575,20938,9027,6898,55170,39875,79827,33295,5963,8012,70392,13915,23812,46761,12571,7260,113714,37399,9155,68805,16205,12520,12134,22800,1355,1971,58238,8869,2662,2354,27258,12648,25739,6425,2199,2538,22542,5455,11719,13541,3834,3004,32754,15526,4995,28597,33613,11064,20071,23289,3713,5542,81271,7234,1678,2943,26973,15430,44711,11264,2525,4188,34954,3478,9728,22646,4162,2656,34448,10172,4248,25092,8970,2152,3147,2288,223,1291,26117,1332,832,950,10598,4262,9365,1861,840,1265,3156,1364,3416,2949,614,1194,13267,5587,993,6634,1713,419,801,795,2,2,2063,255,322,2,33,608,3815,446,2,777,260,9,1415,39,2408,139,82,707,10699,3264,69021,3283,1312,593,1627,16448,3449,46854,3600,345,384,16989,7616,1460,10356,2518,18534,3698,454,1603,1786,4574,3424,2571,2799,4416,5093,6775,35122,8784,3313,1055,953,10017,7316,2968,478,343,17555,9068,53660,10370,659,200,1363,476,4337,21486,1875,1015,610,3716,15964,5487,801,722,220208,29874,12568,4110,2089,31812,10773,120569,1784,199,856,243,13496,7193,1907,3443,1657,12025,5794,326,5214,309,1362,1694,14649,2163,882,1230,674,75766,49490,19938,444,446,26821,2950,26697,12516,2717,10152,5706,23851,984,263,292,138,50990,20661,3570,11090,1632,3148,3138,89867,1833,1145,37838,6984,619,2827,1813,10814,10563,1916,907,570,2391,19326,1153,484,2780,1542,430,489,96941,14217,6163,4145,2538,2121,667,33182,7753,1256,196,3496,2016,10517,44508,7028,4601,1211,492,7460,5905,2713,2628,565,23842,3123,2200,1039,962,9507,3468,33470,354,316,1438,9870,2847,10575,4519,16199,2607,2766,2135,49956,3042,1423,11186,34473,8716,3833,36892,16880,52739,964,3465,12566,42732,7554,21493,11495,11728,3094,937,771,6019,17111,3846,927,1113,32211,10040,4360,399,284,15814,7678,42345,2453,7502,2308,3317,148934,96473,39284,264,2955,6400,14420,90460,134718,18571,11556,36171,765558,118875,71266,28142,11903,163479,62993,567683,70845,641070,210843,263631,59429,15190,309574,447442,147040,183462,55239,1922]
},
"nodeWidth":     15,
"nodePadding":     10,
"layout":     32,
"id": "chart21541f297cdc" 
};

params.units ? units = " " + params.units : units = "";

//hard code these now but eventually make available
var formatNumber = d3.format("0,.0f"),    // zero decimal places
    format = function(d) { return formatNumber(d) + units; },
    color = d3.scale.category20();

if(params.labelFormat){
  formatNumber = d3.format(".2%");
}

var svg = d3.select('#' + params.id).append("svg")
    .attr("width", params.width)
    .attr("height", params.height);
    
var sankey = d3.sankey()
    .nodeWidth(params.nodeWidth)
    .nodePadding(params.nodePadding)
    .layout(params.layout)
    .size([params.width,params.height]);
    
var path = sankey.link();
    
var data = params.data,
    links = [],
    nodes = [];
    
//get all source and target into nodes
//will reduce to unique in the next step
//also get links in object form
data.source.forEach(function (d, i) {
    nodes.push({ "name": data.source[i] });
    nodes.push({ "name": data.target[i] });
    links.push({ "source": data.source[i], "target": data.target[i], "value": +data.value[i] });
}); 

//now get nodes based on links data
//thanks Mike Bostock https://groups.google.com/d/msg/d3-js/pl297cFtIQk/Eso4q_eBu1IJ
//this handy little function returns only the distinct / unique nodes
nodes = d3.keys(d3.nest()
                .key(function (d) { return d.name; })
                .map(nodes));

//it appears d3 with force layout wants a numeric source and target
//so loop through each link replacing the text with its index from node
links.forEach(function (d, i) {
    links[i].source = nodes.indexOf(links[i].source);
    links[i].target = nodes.indexOf(links[i].target);
});

//now loop through each nodes to make nodes an array of objects rather than an array of strings
nodes.forEach(function (d, i) {
    nodes[i] = { "name": d };
});

sankey
  .nodes(nodes)
  .links(links)
  .layout(params.layout);
  
var link = svg.append("g").selectAll(".link")
  .data(links)
.enter().append("path")
  .attr("class", "link")
  .attr("d", path)
  .style("stroke-width", function (d) { return Math.max(1, d.dy); })
  .sort(function (a, b) { return b.dy - a.dy; });

link.append("title")
  .text(function (d) { return d.source.name + " → " + d.target.name + "\n" + format(d.value); });

var node = svg.append("g").selectAll(".node")
  .data(nodes)
.enter().append("g")
  .attr("class", "node")
  .attr("transform", function (d) { return "translate(" + d.x + "," + d.y + ")"; })
.call(d3.behavior.drag()
  .origin(function (d) { return d; })
  .on("dragstart", function () { this.parentNode.appendChild(this); })
  .on("drag", dragmove));

node.append("rect")
  .attr("height", function (d) { return d.dy; })
  .attr("width", sankey.nodeWidth())
  .style("fill", function (d) { return d.color = color(d.name.replace(/ .*/, "")); })
  .style("stroke", function (d) { return d3.rgb(d.color).darker(2); })
.append("title")
  .text(function (d) { return d.name + "\n" + format(d.value); });

node.append("text")
  .attr("x", -6)
  .attr("y", function (d) { return d.dy / 2; })
  .attr("dy", ".35em")
  .attr("text-anchor", "end")
  .attr("transform", null)
  .text(function (d) { return d.name; })
.filter(function (d) { return d.x < params.width / 2; })
  .attr("x", 6 + sankey.nodeWidth())
  .attr("text-anchor", "start");

// the function for moving the nodes
  function dragmove(d) {
    d3.select(this).attr("transform", 
        "translate(" + (
                   d.x = Math.max(0, Math.min(params.width - d.dx, d3.event.x))
                ) + "," + (
                   d.y = Math.max(0, Math.min(params.height - d.dy, d3.event.y))
                ) + ")");
        sankey.relayout();
        link.attr("d", path);
  }
})();
</script>
    
    
    <script>
    // to be specific in case you have more than one chart
    d3.selectAll('#chart21541f297cdc svg path.link')
      .style('stroke', function(d){
        //here we will use the source color
        //if you want target then sub target for source
        //or if you want something other than gray
        //supply a constant
        //or use a categorical scale or gradient
        return d.source.color;
      })
     //note no changes were made to opacity
     //to do uncomment below but will affect mouseover
     //so will need to define mouseover and mouseout
     //happy to show how to do this also
     // .style('stroke-opacity', .7) 
    </script>
        
  </body>
</html>